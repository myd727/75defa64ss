<!DOCTYPE html>
<html lang="ko">
<head>
<meta name="robots" content="noindex, nofollow">
<meta name="googlebot" content="noindex, nofollow">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TRANSMITTER BIT RESULT</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 10px;
    padding: 0;
    overflow-x: hidden;
  }

  h1 {
    text-align: center;
    font-size: 22px;
    margin-bottom: 10px;
  }

  .top-bar {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
    gap: 5px;
    flex-wrap: wrap;
  }

  .lang-btn {
    padding: 5px 10px;
    font-size: 13px;
    font-weight: bold;
    border: 1px solid #333;
    background: #f2f2f2;
    cursor: pointer;
    flex: none;
  }

  .lang-btn.active {
    background: #333;
    color: #fff;
  }

  .input-wrap {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    justify-content: center;
  }

  label {
    font-weight: bold;
    white-space: nowrap;
  }

  input {
    width: 100%;
    max-width: 220px;
    padding: 6px 8px;
    font-size: 16px;
    text-align: center;
    border: 1px solid #333;
    box-sizing: border-box;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    table-layout: fixed;
    margin-bottom: 10px;
  }

  th {
    border: 1px solid #333;
    padding: 8px;
    background: #f2f2f2;
    text-align: center;
    font-weight: bold;
    font-size: 14px;
  }

  td {
    border: 1px solid #333;
    padding: 4px 8px;
    height: 50px;
    overflow: hidden;
    white-space: normal;
    vertical-align: middle;
    text-align: left;
  }

  .left { width: 50%; }
  .right { width: 50%; text-align: center; }

  .fail {
    background: #ffd6d6;
    color: #c40000;
    font-weight: bold;
    letter-spacing: 0.3em;
    text-align: center;
  }

  .ok {
    background: #dff5d8;
    color: #0a7a0a;
    font-weight: bold;
    letter-spacing: 0.3em;
    text-align: center;
  }

  .bit-code {
    font-size: 16px;
    font-weight: bold;
    line-height: 1.1em;
  }

  .bit-name {
    font-size: 13px;
    margin-top: 2px;
    line-height: 1.1em;
    word-break: break-word;
  }

  .btn-wrap {
    text-align: center;
    margin-bottom: 15px;
  }

  .btn-wrap button {
  min-width: 150px;
  text-align: center;
  }

  button {
    padding: 6px 12px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
  }

  @media screen and (max-width: 480px) {
    input { font-size: 14px; }
    .bit-code { font-size: 14px; }
    .bit-name { font-size: 12px; }
    td, th { padding: 3px 5px; }
    button { font-size: 13px; padding: 5px 10px; }
  }

  #analysisArea {
    border: 1px solid #333;
    padding: 10px;
    background: #fafafa;
  }

</style>
</head>

<body>

<div class="top-bar">
  <button class="lang-btn active" id="btnKo">한글</button>
  <button class="lang-btn" id="btnEn">ENGLISH</button>
</div>

<h1 id="title">TRANSMITTER BIT 결과</h1>

<div class="input-wrap">
  <label id="codeLabel">코드입력</label>
  <input id="codeInput" type="text" placeholder="예: 0x77d6 또는 77d6">
</div>

<table id="resultTable">
  <tr>
    <th class="left" id="thBit">비트내용</th>
    <th class="right" id="thResult">점검결과</th>
  </tr>
</table>

<div class="btn-wrap">
  <button id="toggleBtn" style="display:none;">전체 결과 펼치기</button>
  <button id="analysisBtn" style="display:none;">점검결과 해석</button>
</div>

<div id="analysisArea" style="display:none;margin-top:10px;"></div>

<script>
async function sha256(str) {
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest("SHA-256", buf);
  return Array.from(new Uint8Array(hash))
    .map(b => b.toString(16).padStart(2, "0"))
    .join("");
}

function deny() {
  document.body.innerHTML = `
    <div style="text-align:center;margin-top:40px;font-family:Arial,sans-serif">
      <h2 style="color:#c40000">
        ACCESS DENYED<br><br>비밀번호를 틀렸습니다.<br>김복성 주무관 문의 바랍니다</h2>
      <button
        onclick="location.reload()"
        style="
          margin-top:15px;
          padding:8px 16px;
          font-size:14px;
          font-weight:bold;
          cursor:pointer;
          border:1px solid #333;
          background:#f2f2f2;
        ">
        다시 로그인
      </button>
    </div>
  `;
}

(async () => {
  const pw = prompt("탑재반 전화번호 뒤 4자리 937-0000 -김복성(KBS)");
  const hash = await sha256(pw || "");
  if (hash !== "32b39bf12b85ca3a243d1e87f605cbad239fae979c1f32665b436c4342831531") {
    deny();
  }
})();

const langPack = {
  ko: { title:"TRANSMITTER BIT 결과", bit:"비트내용", result:"점검결과", all:"전체 결과 펼치기", pass:"정상", fail:"결함", code:"코드입력", hidePass:"정상 숨기기", placeholder:"예: 0x77d6 또는 77d6", analysis:"점검결과 해석" },
  en: { title:"TRANSMITTER BIT RESULT", bit:"BIT", result:"RESULT", all:"ALL RESULT", pass:"PASS", fail:"FAIL", code:"CODE", hidePass:"HIDE PASS", placeholder:"Ex: 0x77d6 or 77d6", analysis:"ANALYSIS" }
};

let lang = "ko";

const bitMap = [
  { code: "XMGO", name: "Transmit Go" }, { code: "RFIP", name: "RF Input Power" },
  { code: "CUFL", name: "Coolant Flow" }, { code: "TEMP", name: "Temperature" },
  { code: "XMPL", name: "Transmit Power Level" }, { code: "PWRR", name: "Pulse Width / Pulse Rep Rate" },
  { code: "TFPS", name: "TWT Filament Power" }, { code: "VSWR", name: "Voltage Standing Wave Ratio" },
  { code: "DUCY", name: "Duty Cycle" }, { code: "IONC", name: "Ion Pump Current" },
  { code: "HVPS", name: "High Voltage Power Supply" }, { code: "TBOC", name: "TWT Body Current" },
  { code: "TGBV", name: "TWT Grid Bias Voltage" }, { code: "LVPS", name: "Low Voltage Power Supply" },
  { code: "LOCK", name: "Interlocks" }, { code: "XMRY", name: "Transmit Ready" }
];

const analysisMap = {
  XMGO:{ko:"송신기가 NO GO 상태",en:"Transmitter is in NO GO condition"},
  RFIP:{ko:"RF INPUT 전력(RCU 입력) 불안정",en:"RF input power (RCU input) is unstable"},
  CUFL:{ko:"냉각유(PAO) 순환 상태 불량",en:"PAO coolant flow condition is abnormal"},
  TEMP:{ko:"온도 허용범위 미달/초과",en:"Temperature is Out of Tolerance"},
  XMPL:{ko:"송신 전력레벨 허용범위 미달/초과",en:"Transmit power level is Out of Tolerance"},
  PWRR:{ko:"펄스 폭/주기 허용범위 미달/초과",en:"Pulse width / PRR is Out of Tolerance"},
  TFPS:{ko:"진행파관(TWT) 필라멘트 전원 불량",en:"TWT filament power failure"},
  VSWR:{ko:"정재파비(VSWR) 과도 발생",en:"Excessive VSWR detected"},
  DUCY:{ko:"펄스 듀티비 허용범위 미달/초과",en:"Pulse duty cycle is Out of Tolerance"},
  IONC:{ko:"이온펌프 전류량 허용범위 미달/초과",en:"Ion pump current is Out of Tolerance"},
  HVPS:{ko:"고전압 전원공급 허용범위 미달/초과",en:"High voltage power supply is Out of Tolerance"},
  TBOC:{ko:"진행파관 바디전류 과발생",en:"Excessive TWT body current"},
  TGBV:{ko:"진행파관 그리드 바이어스 전압 불량",en:"TWT grid bias voltage failure"},
  LVPS:{ko:"저전압 전원공급 허용범위 미달/초과",en:"Low voltage power supply is Out of Tolerance"},
  LOCK:{ko:"인터록 잠금상태",en:"Interlock is engaged"},
  XMRY:{ko:"송신기가 준비되지 않음",en:"Transmitter is not ready"}
};

const input = document.getElementById("codeInput");
const table = document.getElementById("resultTable");
const btn = document.getElementById("toggleBtn");
const analysisBtn = document.getElementById("analysisBtn");
const analysisArea = document.getElementById("analysisArea");

const btnKo = document.getElementById("btnKo");
const btnEn = document.getElementById("btnEn");

let lastBinary = "";
let showingAll = false;

btnKo.onclick = () => setLanguage("ko");
btnEn.onclick = () => setLanguage("en");

function setLanguage(l) {
  lang = l;
  btnKo.classList.toggle("active", l === "ko");
  btnEn.classList.toggle("active", l === "en");

  // ⭐ 결과 다시 그리기 (핵심)
  if (lastBinary) {
    showingAll ? showAllResults() : showFailOnly();
  }

  applyLanguage();

  if (analysisArea.style.display === "block") showAnalysis();
}

input.addEventListener("input", () => {
  let hex = input.value.trim().toLowerCase();
  if(hex.startsWith("0x")) hex=hex.slice(2);
  if(!/^[0-9a-f]{4}$/.test(hex)){
    clearResults();
    btn.style.display="none";
    analysisBtn.style.display="none";
    analysisArea.style.display="none";
    lastBinary="";
    return;
  }
  lastBinary=parseInt(hex,16).toString(2).padStart(16,"0");
  showingAll=false;
  showFailOnly();
  btn.style.display="inline-block";
  analysisBtn.style.display="inline-block";
  applyLanguage();
});

btn.onclick = () => {
  showingAll ? showFailOnly() : showAllResults();
  showingAll = !showingAll;
  applyLanguage();
};

analysisBtn.onclick = showAnalysis;

function showAnalysis(){
  analysisArea.innerHTML="";
  lastBinary.split("").forEach((bit,i)=>{
    if(bit==="0"){
      const code=bitMap[i].code;
      const div=document.createElement("div");
      div.style.marginBottom="6px";
      div.innerHTML=`<b>${code}</b> : ${analysisMap[code][lang]}`;
      analysisArea.appendChild(div);
    }
  });
  analysisArea.style.display="block";
}

function showFailOnly(){
  clearResults();
  lastBinary.split("").forEach((bit,i)=>{if(bit==="0") appendRow(i,langPack[lang].fail,"fail");});
}

function showAllResults(){
  clearResults();
  lastBinary.split("").forEach((bit,i)=>{appendRow(i,bit==="0"?langPack[lang].fail:langPack[lang].pass,bit==="0"?"fail":"ok");});
}

function appendRow(i,text,cls){
  const info=bitMap[i];
  const row=document.createElement("tr");
  row.innerHTML=`<td class="left"><div class="bit-code">${info.code}</div><div class="bit-name">${info.name}</div></td><td class="right ${cls}">${text}</td>`;
  table.appendChild(row);
}

function clearResults(){
  table.querySelectorAll("tr:not(:first-child)").forEach(tr=>tr.remove());
}

function applyLanguage(){
  document.getElementById("title").textContent=langPack[lang].title;
  document.getElementById("thBit").textContent=langPack[lang].bit;
  document.getElementById("thResult").textContent=langPack[lang].result;
  document.getElementById("codeLabel").textContent=langPack[lang].code;
  btn.textContent = showingAll ? langPack[lang].hidePass : langPack[lang].all;
  analysisBtn.textContent = langPack[lang].analysis;
  input.placeholder=langPack[lang].placeholder;
}
</script>

</body>
</html>
